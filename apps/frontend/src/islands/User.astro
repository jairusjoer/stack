---
import { readMe } from '@directus/sdk';
import { User as ReactUser } from '@/components/react/user.tsx';
import { createAuthenticatedClient, createPublicClient } from '@repo/directus/api/authentication.ts';
import { PUBLIC_URL } from 'astro:env/client';
import { SECRET_EMAIL, SECRET_PASSWORD } from 'astro:env/server';
import { Try } from '@repo/utils/try.ts';

const client = await createAuthenticatedClient({
  url: PUBLIC_URL,
  payload: { email: SECRET_EMAIL, password: SECRET_PASSWORD },
});

const { data: me } = await Try(() => client.request(readMe()));
---

{
  me && (
    <ReactUser
      data={me}
      client:load
    />
  )
}
